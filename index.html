<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Performance-Evaluation-Based-On-WebCodecs</title>
</head>
<textarea style="width: 640px; height: 270px"></textarea>
<canvas width="1920" height="1080"></canvas>
<script type="text/javascript" src="tool.js"></script>
<script>
    let w = 1920;
    let h = 1080;
    const canvas = document.querySelector('canvas');
    const canvasContext = canvas.getContext('2d');
    let imageData = canvasContext.createImageData(w, h);   /// create a canvas buffer (RGBA)
    let data = imageData.data;
    let frame_counter = 0;
    let codec_string = "vp09.00.10.08";
    let frame_number = 100;
    let time_delay = 0;
    var encoder;

    initEncoder();
    drawWithInterval();

    function log(str) {
        document.querySelector('textarea').value += str + '\n';
    }

    function initEncoder() {
        const init = {
            output: (chunk) => {
                // todo : save chunk to local file
            },
            error: (e) => {
                log(e.message);
            }
        };
        const config = {
            codec: codec_string,
            width: w,
            height: h,
            bitrate: 10e6,
        };
        encoder = new VideoEncoder(init);
        encoder.configure(config);
    }
</script>
</html>